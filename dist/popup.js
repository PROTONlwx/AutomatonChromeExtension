(()=>{"use strict";var t,e,n,i,l,o,a,c,d,s=function(t,e,n,i){return new(n||(n=Promise))((function(l,o){function a(t){try{d(i.next(t))}catch(t){o(t)}}function c(t){try{d(i.throw(t))}catch(t){o(t)}}function d(t){var e;t.done?l(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}d((i=i.apply(t,e||[])).next())}))};let u=[],r=[];function p(t){var e;let[n,i]=y("Click"),l=document.createElement("button");l.type="button",l.classList.add("btn","btn-outline-primary","btn-sm","choose-target"),l.textContent=t?JSON.stringify({id:t.id,classList:t.classList}):"Choose target",i.appendChild(l),null===(e=E("actions"))||void 0===e||e.appendChild(n),l.addEventListener("click",f)}function m(t){var e;let[n,i]=y("Input"),l=document.createElement("button");l.type="button",l.classList.add("btn","btn-outline-primary","btn-sm","choose-target"),l.textContent=t?JSON.stringify({id:t.id,classList:t.classList}):"Choose target";let o=document.createElement("div");o.classList.add("input-group","input-group-sm","mb-3");let a=document.createElement("span");a.classList.add("input-group-text"),a.textContent="Input";let c=document.createElement("input");c.type="text",c.classList.add("form-control"),c.value=t?t.text:"Your input",o.appendChild(a),o.appendChild(c),i.appendChild(l),i.appendChild(o),null===(e=E("actions"))||void 0===e||e.appendChild(n),l.addEventListener("click",f)}function v(t){var e;let[n,i]=y("Wait"),l=document.createElement("div");l.classList.add("input-group","input-group-sm","mb-3");let o=document.createElement("span");o.classList.add("input-group-text"),o.textContent="Wait";let a=document.createElement("input");a.type="text",a.classList.add("form-control"),a.value=t?""+t.time/1e3:"";let c=document.createElement("span");c.classList.add("input-group-text"),c.textContent="Second",l.appendChild(o),l.appendChild(a),l.appendChild(c),i.appendChild(l),null===(e=E("actions"))||void 0===e||e.appendChild(n)}function h(t){var e;let[n,i]=y("Goto"),l=document.createElement("div");l.classList.add("input-group","input-group-sm","mb-3");let o=document.createElement("span");o.classList.add("input-group-text"),o.textContent="Goto Step";let a=document.createElement("input");a.type="text",a.classList.add("form-control"),a.value=t?`${t.gotoStep}`:"",l.appendChild(o),l.appendChild(a),i.appendChild(l),null===(e=E("actions"))||void 0===e||e.appendChild(n)}function C(t){var e;let[n,i]=y("Break"),l=document.createElement("div");l.classList.add("input-group","input-group-sm","mb-3");let o=document.createElement("span");o.classList.add("input-group-text"),o.textContent="After";let a=document.createElement("input");a.type="text",a.classList.add("form-control"),a.value=t?`${t.pass}`:"";let c=document.createElement("span");c.classList.add("input-group-text"),c.textContent="Pass",l.appendChild(o),l.appendChild(a),l.appendChild(c),i.appendChild(l),null===(e=E("actions"))||void 0===e||e.appendChild(n)}function f(t){chrome.contextMenus.update("clicker-select",{visible:!0}),t.target instanceof HTMLButtonElement&&(t.target.textContent="Selecting",r.push(t.target))}function L(t){if(t.target instanceof HTMLElement){let e=t.target;for(;!e.classList.contains("action")&&null!=e.parentElement;)e=e.parentElement;e.remove(),function(){let t=(".action",document.querySelectorAll(".action"));for(let e=0;e<t.length;e++)t[e].querySelector(".step-no").textContent=`${e}`}()}}function g(t){var e,n,i,l,o,a,c;let d=null===(n=null===(e=t.querySelector("p.action-type"))||void 0===e?void 0:e.textContent)||void 0===n?void 0:n.toLowerCase();if("click"==d){let e={id:"",classList:""};"Choose target"!==(null===(i=t.querySelector(".choose-target"))||void 0===i?void 0:i.textContent)&&(e=JSON.parse(null!==(o=null===(l=t.querySelector(".choose-target"))||void 0===l?void 0:l.textContent)&&void 0!==o?o:"{id: '', classList: ''}")),u.push({type:d,id:e.id,classList:e.classList})}else if("wait"==d){let e=parseInt(t.querySelector("input").value);e=isNaN(e)?0:1e3*e,u.push({type:d,time:e})}else if("goto"==d){let e=parseInt(t.querySelector("input").value);e=isNaN(e)?0:e,u.push({type:d,gotoStep:e})}else if("break"==d){let e=parseInt(t.querySelector("input").value);e=isNaN(e)?1:e,u.push({type:d,pass:e})}else{if("input"!=d)throw"action type not recognized: "+d;{let e={id:"",classList:""};"Choose target"!==t.querySelector(".choose-target").textContent&&(e=JSON.parse(null!==(c=null===(a=t.querySelector(".choose-target"))||void 0===a?void 0:a.textContent)&&void 0!==c?c:"{id: '', classList: ''}"));let n=t.querySelector("input").value;u.push({type:d,text:n,id:e.id,classList:e.classList})}}}function y(t){var e;let n=document.createElement("div");n.classList.add("row","action");let i=document.createElement("div");i.classList.add("col-1");let l=document.createElement("div");l.classList.add("col-2");let o=document.createElement("div");o.classList.add("col");let a=document.createElement("div");a.classList.add("col-1");let c=document.createElement("span");c.classList.add("badge","bg-secondary","step-no"),c.textContent=`${null===(e=E("actions"))||void 0===e?void 0:e.childElementCount}`;let d=document.createElement("p");d.classList.add("action-type"),d.textContent=t;let s=document.createElement("button");return s.type="button",s.classList.add("btn-close"),i.appendChild(c),l.appendChild(d),a.appendChild(s),n.appendChild(i),n.appendChild(l),n.appendChild(o),n.appendChild(a),s.addEventListener("click",L),[n,o]}function E(t){return document.getElementById(t)}chrome.contextMenus.onClicked.addListener((function(t,e){chrome.tabs.sendMessage(e.id,{request:"lastClicked"},(function(t){r.forEach((e=>e.textContent=t)),r=[],chrome.contextMenus.update("clicker-select",{visible:!1})}))})),null===(t=E("add-click"))||void 0===t||t.addEventListener("click",(()=>p(null))),null===(e=E("add-input"))||void 0===e||e.addEventListener("click",(()=>m(null))),null===(n=E("add-wait"))||void 0===n||n.addEventListener("click",(()=>v(null))),null===(i=E("add-goto"))||void 0===i||i.addEventListener("click",(()=>h(null))),null===(l=E("add-break"))||void 0===l||l.addEventListener("click",(()=>C(null))),null===(o=E("execute"))||void 0===o||o.addEventListener("click",(function(){return s(this,void 0,void 0,(function*(){u=[],document.querySelectorAll(".action").forEach(g);let[t]=yield chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(t.id,{request:"actions",actions:u},(function(t){console.log(t)}))}))})),null===(a=E("save"))||void 0===a||a.addEventListener("click",(function(){return s(this,void 0,void 0,(function*(){u=[],document.querySelectorAll(".action").forEach(g),chrome.storage.sync.set({"click-input-automaton-actions":u},(function(){}))}))})),null===(c=E("clear"))||void 0===c||c.addEventListener("click",(function(){let t=E("actions");for(;null==t?void 0:t.firstChild;)t.removeChild(t.firstChild)})),null===(d=E("chinese"))||void 0===d||d.addEventListener("click",(()=>window.open("https://reetaa.com/#/singlePost/68"))),chrome.storage.sync.get("click-input-automaton-actions",(function(t){let e=t["click-input-automaton-actions"];null==e&&(e=[]),e.forEach((t=>{if("click"==t.type)p(t);else if("wait"==t.type)v(t);else if("goto"==t.type)h(t);else if("break"==t.type)C(t);else{if("input"!=t.type)throw"action type not recognized: "+t.type;m(t)}}))}))})();